schemaVersion: "2.0.0"

metadataTest:
  env:
    - key: LANG
      value: en_US.UTF-8
    - key: LC_ALL
      value: en_US.UTF-8

fileExistenceTests:
  - name: "entrypoint"
    path: "/entrypoint.sh"
    shouldExist: true
    permissions: "-rwxr-xr-x"

# TODO see how to test this part
#  - name: "ROOT_ENV_VAR"
#    path: "/ROOT_ENV_VAR"
#    shouldExist: true
#    permissions: "drw-------"
  - name: No default nginx conf
    path: /etc/nginx/sites-enabled/default
    shouldExist: false
  - name: rstudio nginx conf
    path: "/etc/nginx/sites-enabled/dss.conf"
    shouldExist: true
    permissions: "-rw-r--r--"


fileContentTests:

  - name: "Dss conf"
    path: "/etc/nginx/sites-enabled/dss.conf"
    expectedContents:
      [
        "listen 80 default_server;",
        "listen \\[::\\]:80 default_server",
        "location SAAGIE_BASE_PATH {",
        "proxy_pass http:\\/\\/localhost:8787;",
      ]

commandTests:
  - name: "Workdir"
    command: "pwd"
# TODO checks if / as workdir is normal, shouldn't it be /home/rstudio ?
    expectedOutput: ["/"]
